(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _utils = require('./utils');

/* Functions */

function playSound(sourceNode) {
  sourceNode.start(0);
} /**
   * Implementation of the Spectral Flux onset detection method
   * described in "Simple Spectrum-Based Onset Detection" (http://www.music-ir.org/evaluation/MIREX/2006_abstracts/OD_dixon.pdf)
   */

function setupAudioNodes(context, _ref) {
  var stftData = _ref.stftData;
  var spectralFluxData = _ref.spectralFluxData;
  var standardizedSpectralFluxData = _ref.standardizedSpectralFluxData;

  var sourceNode = context.createBufferSource();
  var spectralFluxProcessor = context.createScriptProcessor(512, 1, 1);

  spectralFluxProcessor.onaudioprocess = function (audioProcessingEvent) {
    var playbackTime = audioProcessingEvent.playbackTime;
    // preprocessedDataBin = playbackTime * 44100 (sample rate) / 441 (STFT hop size)
    var preprocessedDataBin = Math.floor(playbackTime * 100);
    console.log(standardizedSpectralFluxData[preprocessedDataBin]);
  };

  sourceNode.connect(spectralFluxProcessor);
  spectralFluxProcessor.connect(context.destination);

  return {
    sourceNode: sourceNode,
    analyserNode: spectralFluxProcessor
  };
}

function visualize() {
  // audio context variables
  var context = new _utils.AudioContext();

  // canvas variables
  var canvas = document.getElementById('canvas');
  var canvasCtx = canvas.getContext('2d');

  (0, _utils.resizeCanvas)(canvas);
  var width = canvas.width;
  var height = canvas.height;

  canvasCtx.clearRect(0, 0, width, height);

  canvasCtx.fillStyle = 'rgb(0, 0, 0)';
  canvasCtx.fillRect(0, 0, width, height);

  var stftWorker = new _utils.Worker('js/workers/stft-worker.js');

  (0, _utils.loadAudio)(context, 'sounds/flim.mp3').then(function (audioBuffer) {
    var audioBufferData = audioBuffer.getChannelData(0).slice();

    stftWorker.onmessage = function (e) {
      var nodes = setupAudioNodes(context, e.data);
      nodes.sourceNode.buffer = audioBuffer;
      playSound(nodes.sourceNode);
    };

    stftWorker.postMessage(audioBufferData, [audioBufferData.buffer]);
  });
}

visualize();

},{"./utils":2}],2:[function(require,module,exports){
(function (global){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var requestAnimationFrame = global.requestAnimationFrame || function () {
  return global.webkitRequestAnimationFrame || global.mozRequestAnimationFrame || global.oRequestAnimationFrame || global.msRequestAnimationFrame || function (callback) {
    global.setTimeout(callback, 1000 / 60);
  };
}();

var AudioContext = global.AudioContext || global.webkitAudioContext;
var OfflineAudioContext = global.OfflineAudioContext || global.webkitOfflineAudioContext;
var Worker = global.Worker || global.webkitWorker;

function loadAudio(audioContext, url) {
  return new Promise(function (resolve, reject) {
    var request = new XMLHttpRequest();

    request.open('GET', url, true);
    request.responseType = 'arraybuffer';

    var onDecodeSuccess = function onDecodeSuccess(buffer) {
      resolve(buffer);
    };
    var onDecodeFailure = function onDecodeFailure(error) {
      reject(error);
    };

    request.onload = function () {
      audioContext.decodeAudioData(request.response, onDecodeSuccess, onDecodeFailure);
    };

    request.onerror = function () {
      reject(Error('Network Error'));
    };

    request.send();
  });
}

function resizeCanvas(canvas) {
  var displayWidth = canvas.clientWidth;
  var displayHeight = canvas.clientHeight;

  if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
    canvas.width = displayWidth;
    canvas.height = displayHeight;
  }
}

exports.AudioContext = AudioContext;
exports.OfflineAudioContext = OfflineAudioContext;
exports.Worker = Worker;
exports.requestAnimationFrame = requestAnimationFrame;
exports.loadAudio = loadAudio;
exports.resizeCanvas = resizeCanvas;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9ncnVudC1icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvc3BlY3RyYWwtZmx1eC5qcyIsInNyYy91dGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQ2VBLFNBQVMsU0FBUyxDQUFFLFVBQVUsRUFBRTtBQUM5QixZQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0NBQ3JCOzs7OztBQUFBLEFBRUQsU0FBUyxlQUFlLENBQUUsT0FBTyxRQUFnRTtNQUE1RCxRQUFRLFFBQVIsUUFBUTtNQUFFLGdCQUFnQixRQUFoQixnQkFBZ0I7TUFBRSw0QkFBNEIsUUFBNUIsNEJBQTRCOztBQUMzRixNQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztBQUM5QyxNQUFJLHFCQUFxQixHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDOztBQUVyRSx1QkFBcUIsQ0FBQyxjQUFjLEdBQUcsVUFBVSxvQkFBb0IsRUFBRTtBQUNyRSxRQUFJLFlBQVksR0FBRyxvQkFBb0IsQ0FBQyxZQUFZOztBQUFDLEFBRXJELFFBQUksbUJBQW1CLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLENBQUM7QUFDekQsV0FBTyxDQUFDLEdBQUcsQ0FBQyw0QkFBNEIsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7R0FDaEUsQ0FBQzs7QUFFRixZQUFVLENBQUMsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7QUFDMUMsdUJBQXFCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQzs7QUFFbkQsU0FBTztBQUNMLGNBQVUsRUFBRSxVQUFVO0FBQ3RCLGdCQUFZLEVBQUUscUJBQXFCO0dBQ3BDLENBQUM7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ZUFBZSxHQUFHLFNBQWxCLGVBQWUsQ0FBYSxLQUFLLEVBQUU7QUFBRSxZQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7S0FBRSxDQUFDOztBQUUxRCxXQUFPLENBQUMsTUFBTSxHQUFHLFlBQVk7QUFDM0Isa0JBQVksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxlQUFlLEVBQUUsZUFBZSxDQUFDLENBQUM7S0FDbEYsQ0FBQzs7QUFFRixXQUFPLENBQUMsT0FBTyxHQUFHLFlBQVk7QUFDNUIsWUFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO0tBQ2hDLENBQUM7O0FBRUYsV0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0dBQ2hCLENBQUMsQ0FBQztDQUNKOztBQUVELFNBQVMsWUFBWSxDQUFFLE1BQU0sRUFBRTtBQUM3QixNQUFJLFlBQVksR0FBSSxNQUFNLENBQUMsV0FBVyxDQUFDO0FBQ3ZDLE1BQUksYUFBYSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUM7O0FBRXhDLE1BQUksTUFBTSxDQUFDLEtBQUssS0FBSyxZQUFZLElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxhQUFhLEVBQUU7QUFDcEUsVUFBTSxDQUFDLEtBQUssR0FBSSxZQUFZLENBQUM7QUFDN0IsVUFBTSxDQUFDLE1BQU0sR0FBRyxhQUFhLENBQUM7R0FDL0I7Q0FDRjs7UUFHQyxZQUFZLEdBQVosWUFBWTtRQUNaLG1CQUFtQixHQUFuQixtQkFBbUI7UUFDbkIsTUFBTSxHQUFOLE1BQU07UUFDTixxQkFBcUIsR0FBckIscUJBQXFCO1FBQ3JCLFNBQVMsR0FBVCxTQUFTO1FBQ1QsWUFBWSxHQUFaLFlBQVkiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqXG4gKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgU3BlY3RyYWwgRmx1eCBvbnNldCBkZXRlY3Rpb24gbWV0aG9kXG4gKiBkZXNjcmliZWQgaW4gXCJTaW1wbGUgU3BlY3RydW0tQmFzZWQgT25zZXQgRGV0ZWN0aW9uXCIgKGh0dHA6Ly93d3cubXVzaWMtaXIub3JnL2V2YWx1YXRpb24vTUlSRVgvMjAwNl9hYnN0cmFjdHMvT0RfZGl4b24ucGRmKVxuICovXG5cbmltcG9ydCB7XG4gIEF1ZGlvQ29udGV4dCxcbiAgV29ya2VyLFxuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUsXG4gIGxvYWRBdWRpbyxcbiAgcmVzaXplQ2FudmFzXG59IGZyb20gJy4vdXRpbHMnO1xuXG4vKiBGdW5jdGlvbnMgKi9cblxuZnVuY3Rpb24gcGxheVNvdW5kIChzb3VyY2VOb2RlKSB7XG4gIHNvdXJjZU5vZGUuc3RhcnQoMCk7XG59XG5cbmZ1bmN0aW9uIHNldHVwQXVkaW9Ob2RlcyAoY29udGV4dCwgeyBzdGZ0RGF0YSwgc3BlY3RyYWxGbHV4RGF0YSwgc3RhbmRhcmRpemVkU3BlY3RyYWxGbHV4RGF0YSB9KSB7XG4gIHZhciBzb3VyY2VOb2RlID0gY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgdmFyIHNwZWN0cmFsRmx1eFByb2Nlc3NvciA9IGNvbnRleHQuY3JlYXRlU2NyaXB0UHJvY2Vzc29yKDUxMiwgMSwgMSk7XG5cbiAgc3BlY3RyYWxGbHV4UHJvY2Vzc29yLm9uYXVkaW9wcm9jZXNzID0gZnVuY3Rpb24gKGF1ZGlvUHJvY2Vzc2luZ0V2ZW50KSB7XG4gICAgdmFyIHBsYXliYWNrVGltZSA9IGF1ZGlvUHJvY2Vzc2luZ0V2ZW50LnBsYXliYWNrVGltZTtcbiAgICAvLyBwcmVwcm9jZXNzZWREYXRhQmluID0gcGxheWJhY2tUaW1lICogNDQxMDAgKHNhbXBsZSByYXRlKSAvIDQ0MSAoU1RGVCBob3Agc2l6ZSlcbiAgICB2YXIgcHJlcHJvY2Vzc2VkRGF0YUJpbiA9IE1hdGguZmxvb3IocGxheWJhY2tUaW1lICogMTAwKTtcbiAgICBjb25zb2xlLmxvZyhzdGFuZGFyZGl6ZWRTcGVjdHJhbEZsdXhEYXRhW3ByZXByb2Nlc3NlZERhdGFCaW5dKTtcbiAgfTtcblxuICBzb3VyY2VOb2RlLmNvbm5lY3Qoc3BlY3RyYWxGbHV4UHJvY2Vzc29yKTtcbiAgc3BlY3RyYWxGbHV4UHJvY2Vzc29yLmNvbm5lY3QoY29udGV4dC5kZXN0aW5hdGlvbik7XG5cbiAgcmV0dXJuIHtcbiAgICBzb3VyY2VOb2RlOiBzb3VyY2VOb2RlLFxuICAgIGFuYWx5c2VyTm9kZTogc3BlY3RyYWxGbHV4UHJvY2Vzc29yXG4gIH07XG59XG5cbmZ1bmN0aW9uIHZpc3VhbGl6ZSAoKSB7XG4gIC8vIGF1ZGlvIGNvbnRleHQgdmFyaWFibGVzXG4gIHZhciBjb250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuXG4gIC8vIGNhbnZhcyB2YXJpYWJsZXNcbiAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcbiAgdmFyIGNhbnZhc0N0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXG4gIHJlc2l6ZUNhbnZhcyhjYW52YXMpO1xuICB2YXIgd2lkdGggPSBjYW52YXMud2lkdGg7XG4gIHZhciBoZWlnaHQgPSBjYW52YXMuaGVpZ2h0O1xuXG4gIGNhbnZhc0N0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG5cbiAgY2FudmFzQ3R4LmZpbGxTdHlsZSA9ICdyZ2IoMCwgMCwgMCknO1xuICBjYW52YXNDdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG5cbiAgdmFyIHN0ZnRXb3JrZXIgPSBuZXcgV29ya2VyKCdqcy93b3JrZXJzL3N0ZnQtd29ya2VyLmpzJyk7XG5cbiAgbG9hZEF1ZGlvKGNvbnRleHQsICdzb3VuZHMvZmxpbS5tcDMnKS50aGVuKGZ1bmN0aW9uIChhdWRpb0J1ZmZlcikge1xuICAgIGxldCBhdWRpb0J1ZmZlckRhdGEgPSBhdWRpb0J1ZmZlci5nZXRDaGFubmVsRGF0YSgwKS5zbGljZSgpO1xuXG4gICAgc3RmdFdvcmtlci5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgbGV0IG5vZGVzID0gc2V0dXBBdWRpb05vZGVzKGNvbnRleHQsIGUuZGF0YSk7XG4gICAgICBub2Rlcy5zb3VyY2VOb2RlLmJ1ZmZlciA9IGF1ZGlvQnVmZmVyO1xuICAgICAgcGxheVNvdW5kKG5vZGVzLnNvdXJjZU5vZGUpO1xuICAgIH07XG5cbiAgICBzdGZ0V29ya2VyLnBvc3RNZXNzYWdlKGF1ZGlvQnVmZmVyRGF0YSwgW2F1ZGlvQnVmZmVyRGF0YS5idWZmZXJdKTtcbiAgfSk7XG59XG5cbnZpc3VhbGl6ZSgpO1xuIiwidmFyIHJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGdsb2JhbC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgKGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuICBnbG9iYWwud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgZ2xvYmFsLm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgIGdsb2JhbC5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgZ2xvYmFsLm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBnbG9iYWwuc2V0VGltZW91dChjYWxsYmFjaywgMTAwMCAvIDYwKTtcbiAgICAgICAgICB9O1xufSkoKTtcblxudmFyIEF1ZGlvQ29udGV4dCA9IGdsb2JhbC5BdWRpb0NvbnRleHQgfHwgZ2xvYmFsLndlYmtpdEF1ZGlvQ29udGV4dDtcbnZhciBPZmZsaW5lQXVkaW9Db250ZXh0ID0gZ2xvYmFsLk9mZmxpbmVBdWRpb0NvbnRleHQgfHwgZ2xvYmFsLndlYmtpdE9mZmxpbmVBdWRpb0NvbnRleHQ7XG52YXIgV29ya2VyID0gZ2xvYmFsLldvcmtlciB8fCBnbG9iYWwud2Via2l0V29ya2VyO1xuXG5mdW5jdGlvbiBsb2FkQXVkaW8gKGF1ZGlvQ29udGV4dCwgdXJsKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsLCB0cnVlKTtcbiAgICByZXF1ZXN0LnJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcic7XG5cbiAgICB2YXIgb25EZWNvZGVTdWNjZXNzID0gZnVuY3Rpb24gKGJ1ZmZlcikgeyByZXNvbHZlKGJ1ZmZlcik7IH07XG4gICAgdmFyIG9uRGVjb2RlRmFpbHVyZSA9IGZ1bmN0aW9uIChlcnJvcikgeyByZWplY3QoZXJyb3IpOyB9O1xuXG4gICAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBhdWRpb0NvbnRleHQuZGVjb2RlQXVkaW9EYXRhKHJlcXVlc3QucmVzcG9uc2UsIG9uRGVjb2RlU3VjY2Vzcywgb25EZWNvZGVGYWlsdXJlKTtcbiAgICB9O1xuXG4gICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmVqZWN0KEVycm9yKCdOZXR3b3JrIEVycm9yJykpO1xuICAgIH07XG5cbiAgICByZXF1ZXN0LnNlbmQoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJlc2l6ZUNhbnZhcyAoY2FudmFzKSB7XG4gIHZhciBkaXNwbGF5V2lkdGggID0gY2FudmFzLmNsaWVudFdpZHRoO1xuICB2YXIgZGlzcGxheUhlaWdodCA9IGNhbnZhcy5jbGllbnRIZWlnaHQ7XG5cbiAgaWYgKGNhbnZhcy53aWR0aCAhPT0gZGlzcGxheVdpZHRoIHx8IGNhbnZhcy5oZWlnaHQgIT09IGRpc3BsYXlIZWlnaHQpIHtcbiAgICBjYW52YXMud2lkdGggID0gZGlzcGxheVdpZHRoO1xuICAgIGNhbnZhcy5oZWlnaHQgPSBkaXNwbGF5SGVpZ2h0O1xuICB9XG59XG5cbmV4cG9ydCB7XG4gIEF1ZGlvQ29udGV4dCxcbiAgT2ZmbGluZUF1ZGlvQ29udGV4dCxcbiAgV29ya2VyLFxuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUsXG4gIGxvYWRBdWRpbyxcbiAgcmVzaXplQ2FudmFzXG59O1xuIl19
